#!/bin/bash
# make sure there is no preexisting Docker CID file
rm -f /Users/kpk/Desktop/XRBS_wdl/cromwell-executions/XRBS/a58d6736-5d98-4dae-a993-f5cfb84c14b4/call-trimming/execution/docker_cid
# run as in the original configuration without --rm flag (will remove later)
docker run \
  --cidfile /Users/kpk/Desktop/XRBS_wdl/cromwell-executions/XRBS/a58d6736-5d98-4dae-a993-f5cfb84c14b4/call-trimming/execution/docker_cid \
  -i \
   \
  --entrypoint /bin/bash \
  -v /Users/kpk/Desktop/XRBS_wdl/cromwell-executions/XRBS/a58d6736-5d98-4dae-a993-f5cfb84c14b4/call-trimming:/cromwell-executions/XRBS/a58d6736-5d98-4dae-a993-f5cfb84c14b4/call-trimming:delegated \
  salvacasani/trimming@sha256:c2d04933875a1c693485a669f003d8e1e5393701e1b614573ece9b4aee11a01d /cromwell-executions/XRBS/a58d6736-5d98-4dae-a993-f5cfb84c14b4/call-trimming/execution/script

# get the return code (working even if the container was detached)
rc=$(docker wait `cat /Users/kpk/Desktop/XRBS_wdl/cromwell-executions/XRBS/a58d6736-5d98-4dae-a993-f5cfb84c14b4/call-trimming/execution/docker_cid`)

# remove the container after waiting
docker rm `cat /Users/kpk/Desktop/XRBS_wdl/cromwell-executions/XRBS/a58d6736-5d98-4dae-a993-f5cfb84c14b4/call-trimming/execution/docker_cid`

# return exit code
exit $rc
